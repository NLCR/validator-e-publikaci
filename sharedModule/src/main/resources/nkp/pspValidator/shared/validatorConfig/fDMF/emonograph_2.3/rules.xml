<fDMF xmlns="http://www.nkp.cz/validatorEpublikaci/1.0/fdmfConfig"
      validatorVersion="1.0"
      dmf="emonograph_2.3"
>
    <description>
        Zde jsou definovány validační pravidla. K samotným validacím se používají validační funkce, jejichž parametry
        jsou definované proměnné, vzory a konstanty.
        Pravidla je možné dynamicky doplňovat/upravovat, ale je vždy nutné používat existující proměnné a vzory.
    </description>

    <rules-section name="Struktura souborů" description="Struktura PSP balicku na urovni soboru">


        <!--psp dir-->

        <!--mozna tohle patri spise k INFO?-->
        <!--TODO: spis pouzit pattern a checkFilenameMatchesPattern, kdyz matches-->
        <rule name="PSP_DIR_MATCHES_PSP_ID">
            <description>Název kořenového adresáře musí být schodný s PSP-ID.</description>
            <validation functionName="checkFilenameMatchesPattern">
                <params>
                    <value name="level" type="LEVEL">ERROR</value>
                    <value name="file" type="FILE">
                        <value-ref name="PSP_DIR"/>
                    </value>
                    <pattern name="pattern">
                        <expression caseSensitive="true">${PSP_ID}</expression>
                    </pattern>
                </params>
            </validation>
        </rule>


        <!--právě jeden každý top-level soubor-->

        <rule name="SINGLE_INFO_FILE_FOUND">
            <description>Musí být nalezen nanejvýše jeden soubor INFO. Pokud nalezen není, je soubor špatně pojmenován, nebo
                opravdu chybí.
            </description>
            <validation functionName="checkFilelistHasExactSize">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="INFO_FILES"/>
                    </value>
                    <value name="size" type="INTEGER">1</value>
                </params>
            </validation>
        </rule>

        <rule name="SINGLE_PRIMARY-METS_FILE_FOUND">
            <description>Musí být nalezen nanejvýše jeden soubor PRIMARY-METS. Pokud nalezen není, je soubor špatně
                pojmenován, nebo opravdu chybí.
            </description>
            <validation functionName="checkFilelistHasExactSize">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="PRIMARY-METS_FILES"/>
                    </value>
                    <value name="size" type="INTEGER">1</value>
                </params>
            </validation>
        </rule>

        <rule name="SINGLE_CHECKSUM_FILE_FOUND">
            <description>Musí být nalezen nanejvýše jeden soubor CHECKSUM. Pokud nalezen není, je soubor špatně pojmenován,
                nebo opravdu chybí.
            </description>
            <validation functionName="checkFilelistHasExactSize">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="CHECKSUM_FILES"/>
                    </value>
                    <value name="size" type="INTEGER">1</value>
                </params>
            </validation>
        </rule>


        <!--názvy top-level souborů obsahují povolené znaky-->

        <rule name="INFO_FILENAME_VALID">
            <description>Název souboru INFO smí obsahovat jen povolené znaky.</description>
            <validation functionName="checkFilenameMatchesPattern">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="INFO_FILE"/>
                    </value>
                    <pattern name="pattern">
                        <pattern-ref name="FILENAME"/>
                    </pattern>
                </params>
            </validation>
        </rule>

        <rule name="PRIMARY-METS_FILENAME_VALID">
            <description>Název souboru PRIMARY-METS smí obsahovat jen povolené znaky.</description>
            <validation functionName="checkFilenameMatchesPattern">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="PRIMARY-METS_FILE"/>
                    </value>
                    <pattern name="pattern">
                        <pattern-ref name="FILENAME"/>
                    </pattern>
                </params>
            </validation>
        </rule>

        <rule name="CHECKSUM_FILENAME_VALID">
            <description>Název souboru CHECKSUM smí obsahovat jen povolené znaky.</description>
            <validation functionName="checkFilenameMatchesPattern">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="CHECKSUM_FILE"/>
                    </value>
                    <pattern name="pattern">
                        <pattern-ref name="FILENAME"/>
                    </pattern>
                </params>
            </validation>
        </rule>


        <!--top-level soubory nejsou adresáře-->

        <rule name="INFO_IS_NOT_DIR">
            <description>Soubor INFO nesmí být adresář, ale obyčejný soubor.</description>
            <validation functionName="checkFileIsNotDir">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="INFO_FILE"/>
                    </value>
                </params>
            </validation>
        </rule>

        <rule name="PRIMARY-METS_IS_NOT_DIR">
            <description>Soubor PRIMARY-METS nesmí být adresář, ale obyčejný soubor.</description>
            <validation functionName="checkFileIsNotDir">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="PRIMARY-METS_FILE"/>
                    </value>
                </params>
            </validation>
        </rule>

        <rule name="CHECKSUM_IS_NOT_DIR">
            <description>Soubor CHECKSUM nesmí být adresář, ale obyčejný soubor.</description>
            <validation functionName="checkFileIsNotDir">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="CHECKSUM_FILE"/>
                    </value>
                </params>
            </validation>
        </rule>


        <!--žádné top-level soubory/adresáře kromě očekávaných a tolerovaných-->

        <rule name="TOLERATED_TL_FILES_ARE_NOT_DIRS">
            <description>Žádný tolerovaný soubor v kořenovém adresáři nesmí být adresář.</description>
            <validation functionName="checkNoFileIsDir">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="TOLERATED_TL_FILES"/>
                    </value>
                </params>
            </validation>
        </rule>

        <rule name="NO_TOLERATED_TL_FILES_FOUND">
            <description>Ideálně by v kořenovém adresáři neměl být nalezen žádný tolerovaný soubor.</description>
            <validation functionName="checkFilelistHasExactSize">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="TOLERATED_TL_FILES"/>
                    </value>
                    <value name="size" type="INTEGER">0</value>
                    <value name="level" type="LEVEL">WARNING</value>
                </params>
            </validation>
            <!--
                        <validation functionName="CHECK_FILE_LIST_EMPTY">
                            <params>
                                <value name="files" type="FILE_LIST">
                                    <value-ref name="TOLERATED_TL_FILES"/>
                                </value>
                            </params>
                        </validation>-->
        </rule>

        <rule name="NO_OTHER_TL_FILES_FOUND">
            <description>
                Kromě definovaných a tolerovaných souborů a adresářů nesmí být v kořenovém adresáři nalezen žádný další soubor nebo adresář.
            </description>
            <validation functionName="checkNoOtherFilesInDir">
                <params>
                    <value name="root_dir" type="FILE">
                        <value-ref name="PSP_DIR"/>
                    </value>
                    <value name="file" type="FILE">
                        <value-ref name="INFO_FILE"/>
                    </value>
                    <value name="file" type="FILE">
                        <value-ref name="PRIMARY-METS_FILE"/>
                    </value>
                    <value name="file" type="FILE">
                        <value-ref name="CHECKSUM_FILE"/>
                    </value>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="TOLERATED_TL_FILES"/>
                    </value>
                    <value name="file" type="FILE">
                        <value-ref name="ORIGINAL-DIR_FILE"/>
                    </value>
                </params>
            </validation>
        </rule>


        <!--právě jeden každý top-level adresář-->

        <rule name="SINGLE_ORIGINAL-DIR-DIR_FILE_FOUND">
            <description>Musí být nalezen právě jeden adresář ORIGINAL. Pokud nalezen není, je
                adresář špatně pojmenován, nebo opravdu chybí.
            </description>
            <validation functionName="checkFilelistHasExactSize">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="ORIGINAL-DIR_FILES"/>
                    </value>
                    <value name="size" type="INTEGER">1</value>
                </params>
            </validation>
        </rule>


        <!--názvy top-level adresářů obsahují povolené znaky-->

        <rule name="ORIGINAL-DIR_FILE_VALID">
            <description>Název adresáře ORIGINAL musí obsahovat jen povolené znaky.</description>
            <validation functionName="checkFilenameMatchesPattern">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="ORIGINAL-DIR_FILE"/>
                    </value>
                    <pattern name="pattern">
                        <pattern-ref name="FILENAME"/>
                    </pattern>
                </params>
            </validation>
        </rule>


        <!--top-level adresáře jsou adresáře (ne obyčejné soubory)-->

        <rule name="ORIGINAL-DIR_FILE_IS_DIR">
            <description>Soubor ORIGINAL musí být adresář a ne obyčejný soubor.</description>
            <validation functionName="checkFileIsDir">
                <params>
                    <value name="file" type="FILE">
                        <value-ref name="ORIGINAL-DIR_FILE"/>
                    </value>
                </params>
            </validation>
        </rule>


        <!--názvy souborů v top-level adresářích obsahují jen povolené znaky-->

        <!--TODO: soubory v original/-->
        <!--<rule name="SECONDARY-METS_FILENAMES_VALID">
            <description>Všechny soubory SECONDARY-METS musí obsahovat jen povolené znaky.</description>
            <validation functionName="checkAllFilenamesMatchPattern">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="SECONDARY-METS_FILES"/>
                    </value>
                    <pattern name="pattern">
                        <pattern-ref name="FILENAME"/>
                    </pattern>
                </params>
            </validation>
        </rule>-->


        <!--žádný ze souborů v top-level adresářích není adresář-->

        <!--TODO: soubory v original/-->
        <!--<rule name="SECONDARY-METS_FILES_ARE_NOT_DIRS">
            <description>Žádný soubor SECONDARY-METS nesmí být adresář.</description>
            <validation functionName="checkNoFileIsDir">
                <params>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="SECONDARY-METS_FILES"/>
                    </value>
                </params>
            </validation>
        </rule>-->


        <!--žádné další soubory v top-level adresářích-->

        <!--TODO: soubory v original/-->
        <!--<rule name="NO_EXTRA_FILES_IN_SECONDARY-METS-DIR">
            <description>Kromě souborů SECONDARY-METS nesmí adresář SECONDARY-METS-DIR obsahovat žádné další soubory.
            </description>
            <validation functionName="checkNoOtherFilesInDir">
                <params>
                    <value name="root_dir" type="FILE">
                        <value-ref name="SECONDARY-METS-DIR_FILE"/>
                    </value>
                    <value name="files" type="FILE_LIST">
                        <value-ref name="SECONDARY-METS_FILES"/>
                    </value>
                </params>
            </validation>
        </rule>-->

    </rules-section>

</fDMF>
